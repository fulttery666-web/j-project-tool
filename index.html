<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>å®¢æˆ¶å»ºæª”å·¥å…·</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
<style>
    /* 1. å…¨åŸŸå­—é«”è¨­å®š */
    body { 
        font-family: 'Noto Sans TC', 'Microsoft JhengHei', Arial, sans-serif; 
        margin: 0; 
        padding: 0; 
        background: #fafafa; 
    }
    
    /* å°è¦½åˆ— */
    .nav { display: flex; background: #333; color: white; }
    .nav button {
        flex: 1; padding: 15px; border: none; background: #333; color: white;
        font-size: 16px; cursor: pointer;
    }
    .nav button.active { background: #555; }
    .page { display: none; padding: 20px; max-width: 1000px; margin: auto; }
    .page.active { display: block; }

    h2 { margin-top: 0; color: #333; }
    h3 { border-bottom: 2px solid #ddd; padding-bottom: 5px; margin-top: 30px; }

    /* --- æ¬„ä½å°é½Šå„ªåŒ– --- */
    
    .field-row {
        display: flex;
        align-items: flex-start; 
        margin-bottom: 15px;
        border-left: 5px solid #ccc; 
        padding-left: 10px;
    }
    
    .field-row label { 
        font-weight: bold; 
        margin-right: 15px; 
        padding-top: 10px; 
        width: 100px; /* â­ å›ºå®šæ¨™ç±¤å¯¬åº¦ï¼Œè®“å¾Œæ–¹çš„è¼¸å…¥æ¡†é½Šé ­ */
        flex-shrink: 0; 
        text-align: right;
        color: #555;
    }

    .field-row .input-container {
        flex-grow: 1; 
    }

    .field-row input, .field-row textarea {
        width: 100%; 
        padding: 10px; 
        border: 1px solid #ccc; 
        border-radius: 5px;
        box-sizing: border-box; 
        resize: vertical; 
    }

    /* å°ˆé–€çµ¦å–®ä¸€åŸå§‹è³‡æ–™è¼¸å…¥å€çš„æ¨£å¼ */
    #rawInputContainer, #rawInputContainer_full {
        border-left-color: #f7a000; /* çªé¡¯åŸå§‹è³‡æ–™è¼¸å…¥å€ */
        margin-bottom: 30px;
    }

    /* AI çµæœé¡¯ç¤ºå€ */
    .ai-result-section { 
        border-left-color: #007bff; 
        padding-left: 10px;
        margin-bottom: 20px;
    } 
    .ai-result-section textarea { 
        background: #eef; 
        border-color: #007bff; 
        color: #111;
        font-weight: 500;
        min-height: 100px;
        margin-bottom: 15px;
    }

    button.action {
        padding: 10px 15px; background: #007bff; color: white;
        border: none; border-radius: 5px; cursor: pointer; margin-top: 10px;
        margin-bottom: 10px;
        transition: background 0.3s;
    }
    button.action:hover { background: #005fcc; }

    .outputBox { /* è¼¸å‡ºå€ä½¿ç”¨å…±ç”¨ class */
        white-space: pre-wrap; /* è§£æ±ºè‡ªå‹•æ›è¡Œå•é¡Œ */
        background: #fff8e1; 
        padding: 20px;
        margin-top: 20px;
        border-radius: 8px;
        border: 1px solid #ffcc80; 
        min-height: 100px;
        font-size: 15px;
        color: #333;
    }
</style>
</head>

<body>

<div class="nav">
    <button class="active" onclick="switchPage('runPage', this)">é™ªè·‘</button>
    <button onclick="switchPage('fullPage', this)">æ”¶å–®ä¸€æ¢é¾</button>
</div>

<div id="runPage" class="page active">
    <h2>é™ªè·‘å­¸å“¡å»ºæª”</h2>
    
        <div class="field-row">
        <label for="name">åç¨±</label>
        <div class="input-container">
            <input id="name" />
        </div>
    </div>

    <div class="field-row">
        <label for="ig">IG é€£çµ</label>
        <div class="input-container">
            <input id="ig" />
        </div>
    </div>

    <div class="field-row" style="margin-bottom: 30px;">
        <label for="type">ç¶“ç‡Ÿé¡å‹</label>
        <div class="input-container">
            <input id="type" />
        </div>
    </div>
    

        <div class="field-row" id="rawInputContainer" style="flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <label style="width: auto; text-align: left;">èƒŒæ™¯è³‡æ–™æ•´ç†ï¼ˆè²¼åŸå§‹æª”æ¡ˆçš„ä¸€å¤§æ®µæ–‡å­—ï¼‰</label>
            <button class="action" onclick="summarize('run')">AI è‡ªå‹•è§£æä¸¦æ•´ç†</button>
        </div>
        <textarea id="raw_data_input_run" rows="12"></textarea>
    </div>
    
    <hr>
    
    <h3 style="margin-bottom: 20px;">âœ… AI æ•´ç†çµæœ</h3>
    
    <div class="ai-result-section">
        <label for="reason_ai_run">ğŸ“Œ é™ªè·‘åŸå›  (AI æ•´ç†)</label>
        <textarea id="reason_ai_run" rows="4" readonly></textarea>
    </div>

    <div class="ai-result-section">
        <label for="goal_ai_run">âœ… ç¶“ç‡Ÿç›®æ¨™ (AI æ•´ç†)</label>
        <textarea id="goal_ai_run" rows="4" readonly></textarea>
    </div>

    <div class="ai-result-section">
        <label for="background_ai_run">ğŸ’¡ èƒŒæ™¯è³‡æ–™ (AI æ•´ç†)</label>
        <textarea id="background_ai_run" rows="4" readonly></textarea>
    </div>
    
    <hr>

    <button class="action" onclick="generateOutput('run')">è¼¸å‡ºæ•´åˆå…§å®¹</button>

    <h3>è¼¸å‡ºå€ (è«‹è¤‡è£½ä»¥ä¸‹å…§å®¹åˆ° LINE è¨˜äº‹æœ¬)</h3>
    <div id="outputBox_run" class="outputBox"></div>
</div>


<div id="fullPage" class="page">
    <h2>æ”¶å–®ä¸€æ¢é¾å®¢æˆ¶å»ºæª”</h2>
    
        <div class="field-row">
        <label for="name_full">åç¨±</label>
        <div class="input-container">
            <input id="name_full" />
        </div>
    </div>

    <div class="field-row">
        <label for="ig_full">IG é€£çµ</label>
        <div class="input-container">
            <input id="ig_full" />
        </div>
    </div>

    <div class="field-row" style="margin-bottom: 30px;">
        <label for="type_full">ç¶“ç‡Ÿé¡å‹</label>
        <div class="input-container">
            <input id="type_full" />
        </div>
    </div>
    

        <div class="field-row" id="rawInputContainer_full" style="flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <label style="width: auto; text-align: left;">æ”¶å–®èƒŒæ™¯è³‡æ–™ï¼ˆè²¼åŸå§‹æª”æ¡ˆçš„ä¸€å¤§æ®µæ–‡å­—ï¼‰</label>
            <button class="action" onclick="summarize('full')">AI è‡ªå‹•è§£æä¸¦æ•´ç†</button>
        </div>
        <textarea id="raw_data_input_full" rows="12"></textarea>
    </div>
    
    <hr>
    
    <h3 style="margin-bottom: 20px;">âœ… AI æ•´ç†çµæœ</h3>
    
    <div class="ai-result-section">
        <label for="reason_ai_full">ğŸ“ åƒåŠ åŸå›  (AI æ•´ç†)</label>
        <textarea id="reason_ai_full" rows="4" readonly></textarea>
    </div>

    <div class="ai-result-section">
        <label for="goal_ai_full">ğŸ“ˆ ç¶“ç‡Ÿç›®æ¨™ (AI æ•´ç†)</label>
        <textarea id="goal_ai_full" rows="4" readonly></textarea>
    </div>

    <div class="ai-result-section">
        <label for="background_ai_full">ğŸ’ª èƒŒæ™¯/å„ªå‹¢ (AI æ•´ç†)</label>
        <textarea id="background_ai_full" rows="4" readonly></textarea>
    </div>
    
    <hr>

    <button class="action" onclick="generateOutput('full')">è¼¸å‡ºæ•´åˆå…§å®¹</button>

    <h3>è¼¸å‡ºå€ (è«‹è¤‡è£½ä»¥ä¸‹å…§å®¹åˆ° LINE è¨˜äº‹æœ¬)</h3>
    <div id="outputBox_full" class="outputBox"></div>
</div>


<script>
// åˆ‡æ›åˆ†é 
function switchPage(pageId, button) {
    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
    document.querySelectorAll('.nav button').forEach(b => b.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    button.classList.add('active');
}

// !! â­ å¿…å¡«ï¼šè«‹å°‡æ‚¨çš„ Google Gemini API Key è²¼å…¥æ­¤è™• !!
const API_KEY = "AIzaSyCzVGPgU4jI1XONen4PSXV7MqGCNZPmk44"; 
const GEMINI_MODEL = 'gemini-2.5-flash'; 

/**
 * è™•ç† AI æ•´ç†çš„æ ¸å¿ƒå‡½å¼ (åŒ…å«æ‰€æœ‰ 400 éŒ¯èª¤ä¿®æ­£)
 * @param {string} pageType - é é¢é¡å‹ ('run' for é™ªè·‘, 'full' for æ”¶å–®ä¸€æ¢é¾)
 */
async function summarize(pageType) {
    const suffix = pageType === 'run' ? '_run' : '_full';
    
    let classificationKeys;
    let categoryNames;
    
    if (pageType === 'run') {
        classificationKeys = ["reason", "goal", "background"];
        categoryNames = ["é™ªè·‘åŸå› ", "å®¢æˆ¶ç›®æ¨™", "èƒŒæ™¯è³‡æ–™"];
    } else { // full
        classificationKeys = ["reason_full", "goal_full", "background_full"];
        categoryNames = ["åƒåŠ åŸå› ", "ç¶“ç‡Ÿç›®æ¨™", "èƒŒæ™¯å’Œå„ªå‹¢"];
    }

    const rawTextarea = document.getElementById("raw_data_input" + suffix);
    const text = rawTextarea.value;
    
    const outputTextareas = {
        [classificationKeys[0]]: document.getElementById(classificationKeys[0].replace('_full', '_ai_full').replace('reason', 'reason_ai_run')),
        [classificationKeys[1]]: document.getElementById(classificationKeys[1].replace('_full', '_ai_full').replace('goal', 'goal_ai_run')),
        [classificationKeys[2]]: document.getElementById(classificationKeys[2].replace('_full', '_ai_full').replace('background', 'background_ai_run'))
    };

    if (!text.trim()) {
        console.error("éŒ¯èª¤ï¼šè«‹å…ˆè²¼å…¥åŸå§‹è³‡æ–™ï¼");
        alert("è«‹å…ˆè²¼å…¥åŸå§‹è³‡æ–™ï¼");
        return;
    }
    
    if (API_KEY === "YOUR_API_KEY_HERE" || API_KEY.length < 20) {
        console.error("éŒ¯èª¤ï¼šè«‹å…ˆå¡«å…¥æ‚¨çš„ Google Gemini API Keyï¼");
        Object.values(outputTextareas).forEach(ta => ta.value = "éŒ¯èª¤ï¼šè«‹å…ˆåœ¨ç¨‹å¼ç¢¼ä¸­å¡«å…¥æ‚¨çš„ Google Gemini API Keyï¼");
        return;
    }
    
    Object.values(outputTextareas).forEach(ta => {
        ta.value = '';
        ta.placeholder = "ï¼ˆGemini AI æ­£åœ¨è§£æèˆ‡æ•´ç†ä¸­ï¼Œè«‹ç¨å€™â€¦ï¼‰";
    });
    rawTextarea.style.border = '2px solid orange'; 

    try {
        
        // ä¿®æ­£ JSON çµæ§‹éŒ¯èª¤ (è§£æ±º 400 éŒ¯èª¤çš„é—œéµ)
        const jsonSchema = {
            type: "object",
            properties: {
                [classificationKeys[0]]: { type: "string", description: `æ•´ç†å¾Œçš„${categoryNames[0]}ï¼ˆæ¢åˆ—å¼ï¼‰` },
                [classificationKeys[1]]: { type: "string", description: `æ•´ç†å¾Œçš„${categoryNames[1]}ï¼ˆæ¢åˆ—å¼ï¼‰` },
                [classificationKeys[2]]: { type: "string", description: `æ•´ç†å¾Œçš„${categoryNames[2]}ï¼ˆæ¢åˆ—å¼ï¼‰` }
            },
            required: classificationKeys,
        };

        const systemPrompt = `ä½ æ˜¯ä¸€ä½è³‡æ·±å®¢æˆ¶é¡§å•ï¼Œè«‹å°‡ä½¿ç”¨è€…è²¼ä¸Šçš„ä¸€å¤§æ®µåŸå§‹è³‡æ–™ï¼Œ**ç²¾æº–è§£æ**ä¸¦**åš´æ ¼**æ•´ç†æˆä»¥ä¸‹ä¸‰å€‹ç¨ç«‹çš„æ¬„ä½ï¼š
        1. ${categoryNames[0]} 
        2. ${categoryNames[1]} 
        3. ${categoryNames[2]} 
        
        è«‹ä½¿ç”¨**æ¸…æ™°çš„æ¢åˆ—å¼**æ‘˜è¦å‘ˆç¾ï¼Œé¿å…åŠ å…¥ä¸»è§€æ¨æ¸¬ã€‚`;
        
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${GEMINI_MODEL}:generateContent?key=${API_KEY}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    contents: [{ 
                        role: "user", 
                        parts: [{ text: systemPrompt + "\n\nåŸå§‹å®¢æˆ¶è³‡æ–™ï¼š" + text }]
                    }],
                config: {
                    temperature: 0.0, 
                    responseMimeType: "application/json", 
                    responseSchema: jsonSchema // ä½¿ç”¨ Schema ç¢ºä¿ JSON è¼¸å‡º
                }
                })
        });
        
        if (!response.ok) {
            throw new Error(`API éŒ¯èª¤ï¼š${response.status} ${response.statusText}`);
        }

        const result = await response.json();
        const jsonString = result.candidates?.[0]?.content?.parts?.[0]?.text;
        
        if (jsonString) {
            const parsedData = JSON.parse(jsonString);
            
            outputTextareas[classificationKeys[0]].value = parsedData[classificationKeys[0]] ? parsedData[classificationKeys[0]].trim() : 'AI ç„¡æ³•è§£ææ­¤åˆ†é¡';
            outputTextareas[classificationKeys[1]].value = parsedData[classificationKeys[1]] ? parsedData[classificationKeys[1]].trim() : 'AI ç„¡æ³•è§£ææ­¤åˆ†é¡';
            outputTextareas[classificationKeys[2]].value = parsedData[classificationKeys[2]] ? parsedData[classificationKeys[2]].trim() : 'AI ç„¡æ³•è§£ææ­¤åˆ†é¡';
        } else {
             const errorMsg = "AI è§£æå¤±æ•—ï¼Œç„¡æœ‰æ•ˆ JSON å›æ‡‰ã€‚è«‹æª¢æŸ¥åŸå§‹è¼¸å…¥å…§å®¹ã€‚";
             Object.values(outputTextareas).forEach(ta => ta.value = errorMsg);
             console.error("Gemini API å›æ‡‰çµæ§‹éŒ¯èª¤:", result);
        }

    } catch (error) {
        console.error("AI æ•´ç†å¤±æ•—ï¼š", error);
        const errorMsg = `AI æ•´ç†å¤±æ•—ï¼Œè«‹æª¢æŸ¥ API Key æˆ–ç¶²è·¯é€£ç·šã€‚éŒ¯èª¤è³‡è¨Šï¼š${error.message}`;
        Object.values(outputTextareas).forEach(ta => ta.value = errorMsg);
    } finally {
        Object.values(outputTextareas).forEach(ta => ta.placeholder = ""); 
        rawTextarea.style.border = '1px solid #ccc'; 
    }
} 

/**
 * è¼¸å‡ºæ•´åˆå…§å®¹ (ä¿®æ­£æ ¼å¼å’Œç´”æ›è¡Œ)
 * @param {string} pageType - é é¢é¡å‹ ('run' for é™ªè·‘, 'full' for æ”¶å–®ä¸€æ¢é¾)
 */
function generateOutput(pageType) {
    const suffix = pageType === 'run' ? '_run' : '_full';
    const outputBoxId = "outputBox" + suffix;

    const name = document.getElementById("name" + (pageType === 'full' ? '_full' : '')).value;
    const ig = document.getElementById("ig" + (pageType === 'full' ? '_full' : '')).value;
    const type = document.getElementById("type" + (pageType === 'full' ? '_full' : '')).value;
    
    const reason = document.getElementById("reason_ai" + suffix).value; 
    const goal = document.getElementById("goal_ai" + suffix).value;
    const background = document.getElementById("background_ai" + suffix).value;

    let title, reasonLabel, goalLabel, backgroundLabel;
    
    if (pageType === 'run') {
        reasonLabel = "ğŸ“Œ é™ªè·‘åŸå› ";
        goalLabel = "âœ… å®¢æˆ¶ç›®æ¨™";
        backgroundLabel = "ğŸ’¡ èƒŒæ™¯/å„ªå‹¢";
    } else { // full
        reasonLabel = "ğŸ“ åƒåŠ åŸå› ";
        goalLabel = "ğŸ“ˆ ç¶“ç‡Ÿç›®æ¨™";
        backgroundLabel = "ğŸ’ª èƒŒæ™¯/å„ªå‹¢";
    }

    const output =
`å®¢æˆ¶æª”æ¡ˆâœï¸ 
ã€${name || 'ï¼ˆæœªå‘½åï¼‰'}ã€‘

ğŸ”— IG é€£çµï¼šhttp://instagram.com/${ig || 'ï¼ˆæœªè¼¸å…¥ï¼‰'}
ğŸ’¼ ç¶“ç‡Ÿé¡å‹ï¼š${type || 'ï¼ˆæœªè¼¸å…¥ï¼‰'}

${reasonLabel}ï¼š
${reason || 'ï¼ˆå°šæœªæ•´ç†ï¼‰'}

${goalLabel}ï¼š
${goal || 'ï¼ˆå°šæœªæ•´ç†ï¼‰'}

${backgroundLabel}ï¼š
${background || 'ï¼ˆå°šæœªæ•´ç†ï¼‰'}
`;

    document.getElementById(outputBoxId).textContent = output;
} 

document.addEventListener('DOMContentLoaded', () => {
    // é¦–æ¬¡è¼‰å…¥æ™‚å•Ÿå‹• 'runPage'
    switchPage('runPage', document.querySelector('.nav button'));
});
</script>

</body>
</html>